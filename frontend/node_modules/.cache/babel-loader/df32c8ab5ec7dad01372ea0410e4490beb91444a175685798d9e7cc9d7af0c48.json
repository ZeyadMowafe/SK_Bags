{"ast":null,"code":"const API_BASE_URL = 'http://localhost:8000/api';\n\n// Token management\nconst getToken = () => localStorage.getItem('authToken');\nconst setToken = token => localStorage.setItem('authToken', token);\nconst removeToken = () => localStorage.removeItem('authToken');\n\n// API request helper\nconst apiRequest = async (endpoint, options = {}) => {\n  const token = getToken();\n  const config = {\n    headers: {\n      'Content-Type': 'application/json',\n      ...(token && {\n        'Authorization': `Bearer ${token}`\n      }),\n      ...options.headers\n    },\n    ...options\n  };\n  try {\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, config);\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('API request failed:', error);\n    throw error;\n  }\n};\n\n// Product API\nconst getProducts = async () => {\n  return apiRequest('/products');\n};\nconst getProduct = async id => {\n  return apiRequest(`/products/${id}`);\n};\n\n// Order API\nconst createOrder = async orderData => {\n  console.log('Sending order data:', orderData);\n  console.log('Stringified body:', JSON.stringify(orderData));\n  return apiRequest('/orders', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(orderData)\n  });\n};\nconst getOrders = async () => {\n  return apiRequest('/orders');\n};\nconst updateOrderStatus = async (orderId, status) => {\n  try {\n    const response = await apiRequest(`/orders/${orderId}/status`, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        status\n      })\n    });\n    return response;\n  } catch (error) {\n    console.error('Error updating order status:', error);\n    throw error;\n  }\n};\n\n// Auth API\nconst login = async credentials => {\n  // Create FormData to match OAuth2PasswordRequestForm expected by FastAPI\n  const formData = new URLSearchParams();\n  formData.append('username', credentials.email); // FastAPI OAuth2 expects 'username'\n  formData.append('password', credentials.password);\n  const response = await fetch(`${API_BASE_URL}/auth/login`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    },\n    body: formData\n  });\n  if (!response.ok) {\n    throw new Error(`HTTP error! status: ${response.status}`);\n  }\n  const data = await response.json();\n  if (data.access_token) {\n    setToken(data.access_token);\n  }\n  return data;\n};\nconst logout = () => {\n  removeToken();\n};\n\n// Admin API\nconst createProduct = async productData => {\n  return apiRequest('/admin/products', {\n    method: 'POST',\n    body: JSON.stringify(productData)\n  });\n};\nconst updateProduct = async (id, productData) => {\n  return apiRequest(`/admin/products/${id}`, {\n    method: 'PUT',\n    body: JSON.stringify(productData)\n  });\n};\nconst deleteProduct = async id => {\n  try {\n    const response = await fetch(`${API_BASE_URL}/admin/products/${id}`, {\n      method: 'DELETE',\n      headers: {\n        'Authorization': `Bearer ${getToken()}`,\n        'Content-Type': 'application/json'\n      }\n    });\n    if (!response.ok) {\n      var _errorData$message;\n      const errorData = await response.json();\n\n      // إذا كان الخطأ بسبب قيود المفتاح الخارجي\n      if (errorData.code === '23503' || (_errorData$message = errorData.message) !== null && _errorData$message !== void 0 && _errorData$message.includes('foreign key constraint')) {\n        throw new Error('Cannot delete product. It is associated with existing orders.');\n      }\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('Error deleting product:', error);\n    throw error;\n  }\n};\nconst uploadFile = async file => {\n  const formData = new FormData();\n  formData.append('file', file);\n  const token = getToken();\n  const response = await fetch(`${API_BASE_URL}/upload-simple`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`\n    },\n    body: formData\n  });\n  if (!response.ok) {\n    throw new Error(`HTTP error! status: ${response.status}`);\n  }\n  const data = await response.json();\n  // Prefer absolute url if provided, else fallback to relative\n  if (data && data.url && !data.url.startsWith('http')) {\n    data.url = `http://localhost:8000${data.url}`;\n  }\n  return data;\n};\n\n// Export API service\nexport const apiService = {\n  // Products\n  getProducts,\n  getProduct,\n  // Orders\n  createOrder,\n  getOrders,\n  updateOrderStatus,\n  // Auth\n  login,\n  logout,\n  // Admin\n  createProduct,\n  updateProduct,\n  deleteProduct,\n  uploadFile,\n  // Utils\n  getToken,\n  setToken,\n  removeToken\n};","map":{"version":3,"names":["API_BASE_URL","getToken","localStorage","getItem","setToken","token","setItem","removeToken","removeItem","apiRequest","endpoint","options","config","headers","response","fetch","ok","Error","status","json","error","console","getProducts","getProduct","id","createOrder","orderData","log","JSON","stringify","method","body","getOrders","updateOrderStatus","orderId","login","credentials","formData","URLSearchParams","append","email","password","data","access_token","logout","createProduct","productData","updateProduct","deleteProduct","_errorData$message","errorData","code","message","includes","uploadFile","file","FormData","url","startsWith","apiService"],"sources":["C:/Users/Mowafy/Desktop/Hand_Made/frontend/src/services/api.js"],"sourcesContent":["const API_BASE_URL = 'http://localhost:8000/api';\r\n\r\n// Token management\r\nconst getToken = () => localStorage.getItem('authToken');\r\nconst setToken = (token) => localStorage.setItem('authToken', token);\r\nconst removeToken = () => localStorage.removeItem('authToken');\r\n\r\n// API request helper\r\nconst apiRequest = async (endpoint, options = {}) => {\r\n  const token = getToken();\r\n  const config = {\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...(token && { 'Authorization': `Bearer ${token}` }),\r\n      ...options.headers,\r\n    },\r\n    ...options,\r\n  };\r\n\r\n  try {\r\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, config);\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n    \r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('API request failed:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Product API\r\nconst getProducts = async () => {\r\n  return apiRequest('/products');\r\n};\r\n\r\nconst getProduct = async (id) => {\r\n  return apiRequest(`/products/${id}`);\r\n};\r\n\r\n// Order API\r\nconst createOrder = async (orderData) => {\r\n  console.log('Sending order data:', orderData);\r\n  console.log('Stringified body:', JSON.stringify(orderData));\r\n  \r\n  return apiRequest('/orders', {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify(orderData),\r\n  });\r\n};\r\nconst getOrders = async () => {\r\n  return apiRequest('/orders');\r\n};\r\n\r\nconst updateOrderStatus = async (orderId, status) => {\r\n  try {\r\n    const response = await apiRequest(`/orders/${orderId}/status`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ status }),\r\n    });\r\n    return response;\r\n  } catch (error) {\r\n    console.error('Error updating order status:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Auth API\r\nconst login = async (credentials) => {\r\n  // Create FormData to match OAuth2PasswordRequestForm expected by FastAPI\r\n  const formData = new URLSearchParams();\r\n  formData.append('username', credentials.email); // FastAPI OAuth2 expects 'username'\r\n  formData.append('password', credentials.password);\r\n  \r\n  const response = await fetch(`${API_BASE_URL}/auth/login`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded',\r\n    },\r\n    body: formData,\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`HTTP error! status: ${response.status}`);\r\n  }\r\n  \r\n  const data = await response.json();\r\n  \r\n  if (data.access_token) {\r\n    setToken(data.access_token);\r\n  }\r\n  \r\n  return data;\r\n};\r\n\r\nconst logout = () => {\r\n  removeToken();\r\n};\r\n\r\n// Admin API\r\nconst createProduct = async (productData) => {\r\n  return apiRequest('/admin/products', {\r\n    method: 'POST',\r\n    body: JSON.stringify(productData),\r\n  });\r\n};\r\n\r\nconst updateProduct = async (id, productData) => {\r\n  return apiRequest(`/admin/products/${id}`, {\r\n    method: 'PUT',\r\n    body: JSON.stringify(productData),\r\n  });\r\n};\r\n\r\nconst deleteProduct = async (id) => {\r\n  try {\r\n    const response = await fetch(`${API_BASE_URL}/admin/products/${id}`, {\r\n      method: 'DELETE',\r\n      headers: {\r\n        'Authorization': `Bearer ${getToken()}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      \r\n      // إذا كان الخطأ بسبب قيود المفتاح الخارجي\r\n      if (errorData.code === '23503' || errorData.message?.includes('foreign key constraint')) {\r\n        throw new Error('Cannot delete product. It is associated with existing orders.');\r\n      }\r\n      \r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n    \r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('Error deleting product:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst uploadFile = async (file) => {\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n  \r\n  const token = getToken();\r\n  const response = await fetch(`${API_BASE_URL}/upload-simple`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${token}`,\r\n    },\r\n    body: formData,\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`HTTP error! status: ${response.status}`);\r\n  }\r\n  \r\n  const data = await response.json();\r\n  // Prefer absolute url if provided, else fallback to relative\r\n  if (data && data.url && !data.url.startsWith('http')) {\r\n    data.url = `http://localhost:8000${data.url}`;\r\n  }\r\n  return data;\r\n};\r\n\r\n// Export API service\r\nexport const apiService = {\r\n  // Products\r\n  getProducts,\r\n  getProduct,\r\n  \r\n  // Orders\r\n  createOrder,\r\n  getOrders,\r\n  updateOrderStatus,\r\n  \r\n  // Auth\r\n  login,\r\n  logout,\r\n  \r\n  // Admin\r\n  createProduct,\r\n  updateProduct,\r\n  deleteProduct,\r\n  uploadFile,\r\n  \r\n  // Utils\r\n  getToken,\r\n  setToken,\r\n  removeToken,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}